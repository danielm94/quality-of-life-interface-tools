on_startup = {
	edict_commander_set_all_trade_node_flags = yes
	set_all_movement_edict_flags = yes
}

on_institution_embracement = {
	if = {
		limit = {
			ai = no
			is_lacking_institutions = no
		}
		every_owned_province = {
			limit = {
				is_state = yes
				has_state_edict = edict_advancement_effort
				can_change_state_edict = yes
			}
			set_state_edict = no_edict
		}
	}
}

on_province_religion_converted = {
	if = {
		limit = {
			owner = {
				ai = no
			}
		}
		owner = {
			edict_commander_calculate_religion_strength = yes
			edict_commander_enforce_religious_unity_easiest_to_convert = yes
		}
		#Clean up edict
		owner = {
			every_owned_province = {
				limit = {
					is_state = yes
					has_state_edict = edict_religious_unity
					can_change_state_edict = yes
					all_province_in_state = {
						OR = {
							religion = owner
							owner = {
								has_harmonized_with = PREV
							}
							owner = {
								secondary_religion = PREV
							}
						}
					}
				}
				set_state_edict = no_edict
			}
		}
	}
}

on_siege_lost_province = {
	if = {
		limit = {
			owner = {
				ai = no
			}
		}
		if = {
			limit = {
				NOT = {
					has_state_edict = edict_defensive_edict
				}
			}
			if = {
				limit = {
					any_province_in_state = {
						has_fort_building_trigger = yes
						controlled_by = owner
					}
				}
				edict_commander_set_edict_for_state = {
					edict = edict_defensive_edict
				}
			}
		}
		else = {
			if = {
				limit = {
					NOT = {
						any_province_in_state = {
							has_fort_building_trigger = yes
							controlled_by = owner
						}
					}
				}
				set_state_edict = no_edict
			}
		}
	}
}

on_adm_development = {
	if = {
		limit = {
			owner = {
				ai = no
			}
			is_state = yes
			can_change_state_edict = yes
			NOT = {
				has_state_edict = edict_encourage_development
			}
		}
		edict_commander_set_edict_for_state = {
			edict = edict_encourage_development
		}
	}
}

on_dip_development = {
	if = {
		limit = {
			owner = {
				ai = no
			}
			is_state = yes
			can_change_state_edict = yes
			NOT = {
				has_state_edict = edict_encourage_development
			}
		}
		edict_commander_set_edict_for_state = {
			edict = edict_encourage_development
		}
	}
}

on_mil_development = {
	if = {
		limit = {
			owner = {
				ai = no
			}
			is_state = yes
			can_change_state_edict = yes
			NOT = {
				has_state_edict = edict_encourage_development
			}
		}
		edict_commander_set_edict_for_state = {
			edict = edict_encourage_development
		}
	}
}
